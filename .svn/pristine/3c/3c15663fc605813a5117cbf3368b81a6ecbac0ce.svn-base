package com.howbuy.jso.service.network;

import java.io.IOException;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.SocketChannel;
import java.util.concurrent.Future;

import com.howbuy.jso.service.network.thread.SocketReadyThread;
import com.howbuy.network.entity.Result;

public class MyNioClient
{
    private Selector sel;
    
    private SocketReadyThread task;
    
    public MyNioClient(int port) throws IOException
    {
        SocketChannel sc = SocketChannel.open();
        sc.configureBlocking(false);
        sc.connect(new InetSocketAddress(InetAddress.getLocalHost(), port));
        sel = Selector.open();
        sc.register(sel, SelectionKey.OP_CONNECT | SelectionKey.OP_READ);
        
        task = new SocketReadyThread(sel);
        new Thread(task).start();
    }

    /**
     * 线程安全的
     * @param message
     */
    public Future<Result> dispatch(byte[] message)
    {
        Future<Result> result = task.getResult();
        return result;
    }
}
